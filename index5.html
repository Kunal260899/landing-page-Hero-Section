<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scroll Animation + WebM + Sticky Nav</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&display=swap" rel="stylesheet">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      color: white;
      font-family: "Poppins", sans-serif;
      overflow-x: hidden;
    }

    section {
      height: 300vh;
      position: relative;
      background: black;
    }

    .sticky-wrapper {
      position: sticky;
      top: 0;
      width: 100%;
      height: 100vh;
      overflow: hidden;
      background: black;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: opacity 0.8s ease;
    }

    .intro-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 10;
      transition: opacity 1s ease, transform 1s ease;
    }

    .intro-overlay.fade-out {
      opacity: 0;
      transform: translateY(-20px);
      pointer-events: none;
    }

    .hero-section-h1 {
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      margin: 0;
      opacity: 0.9;
      font-family: 'Orbitron', sans-serif;
      color: #3974cc;
    }

    .hero-section-p {
      font-size: clamp(1.2rem, 6vw, 2.5rem);
      font-weight: 600;
      letter-spacing: 1px;
      margin-top: 0.5rem;
      font-family: 'Orbitron', sans-serif;
      color: #c3915e;
    }

    .hero-section-h1 em, .hero-section-p em {
      color: #dcdc8b;
    }

    .scroll-indicator {
      position: absolute;
      font-family: 'Orbitron', sans-serif;
      bottom: 30px;
      font-size: 2rem;
      animation: bounce 1.5s infinite;
      opacity: 0.8;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(8px); }
    }

    .end-video {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: black;
      opacity: 0;
      pointer-events: none;
      z-index: 100;
      transition: opacity 1s ease;
      will-change: opacity;
    }

    .end-video.active {
      pointer-events: all;
    }

    .end-video video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      padding-top: 10vh;
      top: 0;
      left: 0;
      z-index: -1;
    }

    .nav-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 25vh;
      transform: perspective(500px) rotateY(-25deg);
      z-index: 200;
      transition: all 0.5s ease;
    }

    .nav-buttons button {
      background-color: #1e1e1e;
      color: #d4d4d4;
      border: 1px solid #333;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .nav-buttons button:hover {
      color: #ffffff;
      background-color: #161616;
    }

    .nav-buttons button:active {
      transform: translateY(1px);
      background-color: #0f0f0f;
      color: white;
    }

    @media (max-width: 768px) {
        .nav-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-top: 9rem;
            margin-left: 2rem;
            width: 90%;
            max-width: 15rem;
        }

        .nav-buttons button {
            width: 100%;
            font-size: 0.9rem;
            padding: 0.6rem 0.8rem;
        }
    }

    /* Fixed navbar (for lower sections) */
    .fixed-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: none;
      justify-content: center;
      background: rgba(0,0,0,0.85);
      padding: 1rem;
      z-index: 300;
      transition: opacity 0.3s ease;
    }

    .fixed-nav.show {
      display: flex;
    }

    .after {
      height: 100vh;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
    }
  </style>
</head>

<body>
  <div class="fixed-nav" id="fixedNav">
    <button onclick="scrollToSection('home')">Home</button>
    <button onclick="scrollToSection('projects')">Projects</button>
    <button onclick="scrollToSection('about')">About</button>
    <button onclick="scrollToSection('contact')">Contact</button>
  </div>

  <section>
    <div class="sticky-wrapper">
      <canvas id="sequence"></canvas>

      <div class="intro-overlay" id="introOverlay">
        <h1 class="hero-section-h1"><em>&lt;h1&gt;&nbsp;</em>  Hi! My name is  <em>&lt;/h1&gt;</em></h1>
        <p id="hero-section-p" class="hero-section-p"></p>
        <div class="scroll-indicator">Scroll<br>â‡“</div>
      </div>

      <div class="end-video" id="endVideo">
        <video src="mac.webm" autoplay muted loop playsinline></video>
        <div class="nav-buttons" id="navButtons">
          <button onclick="scrollToSection('home')">Home</button>
          <button onclick="scrollToSection('projects')">Projects</button>
          <button onclick="scrollToSection('about')">About</button>
          <button onclick="scrollToSection('contact')">Contact</button>
        </div>
      </div>
    </div>
  </section>

  <section id="home" class="after" style="background:#111;">Home Section</section>
  <section id="projects" class="after" style="background:#181818;">Projects Section</section>
  <section id="about" class="after" style="background:#222;">About Section</section>
  <section id="contact" class="after" style="background:#2a2a2a;">Contact Section</section>

  <script>
    gsap.registerPlugin(ScrollTrigger);

    // Typewriter effect
    let i = 0;
    const txt = "<p>  Kunal Sondkar  </p>";
    const speed = 125;
    function typeWriter() {
      if (i < txt.length) {
        document.getElementById("hero-section-p").innerHTML += txt.charAt(i);
        i++;
        setTimeout(typeWriter, speed);
      }
    }

    // Scroll animation setup
    const frameCount = 75;
    const currentFrame = i => `img/${i}.webp`;
    const canvas = document.getElementById("sequence");
    const context = canvas.getContext("2d");
    const images = [];
    const imageSeq = { frame: 1 };

    for (let i = 1; i <= frameCount; i++) {
      const img = new Image();
      img.src = currentFrame(i);
      images.push(img);
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      render();
    }

    function render() {
      const img = images[Math.floor(imageSeq.frame) - 1];
      if (!img || !img.complete) return;
      const scale = Math.max(
        canvas.width / img.width,
        canvas.height / img.height
      );
      const x = (canvas.width / 2) - (img.width / 2) * scale;
      const y = (canvas.height / 2) - (img.height / 2) * scale;
      context.clearRect(0, 0, canvas.width, canvas.height);
      context.drawImage(img, x, y, img.width * scale, img.height * scale);
    }

    images[0].onload = render;
    gsap.to(imageSeq, {
      frame: frameCount,
      snap: "frame",
      ease: "none",
      scrollTrigger: {
        trigger: "section",
        start: "top top",
        end: "bottom bottom",
        scrub: 1,
        pin: ".sticky-wrapper",
      },
      onUpdate: render,
    });

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Fade out intro overlay on scroll
    const overlay = document.getElementById("introOverlay");
    window.addEventListener("scroll", () => {
      overlay.classList.add("fade-out");
    }, { once: true });

    window.onload = typeWriter;

    // Video + navigation control
    const endVideo = document.getElementById("endVideo");
    const navButtons = document.getElementById("navButtons");

    ScrollTrigger.create({
      trigger: "section",
      start: "90% bottom",
      end: "bottom top",
      onEnter: () => {
        endVideo.classList.add("active");
        gsap.to(canvas, { opacity: 0, duration: 1 });
        gsap.to(endVideo, { opacity: 1, duration: 1 });
        gsap.to(navButtons, { opacity: 1, delay: 1, duration: 1 });
      },
      onLeaveBack: () => {
        endVideo.classList.remove("active");
        gsap.to(navButtons, { opacity: 0, duration: 0.5 });
        gsap.to(endVideo, { opacity: 0, duration: 1 });
        gsap.to(canvas, { opacity: 1, duration: 1 });
      }
    });

    // Fixed nav visibility toggle
    const fixedNav = document.getElementById("fixedNav");
    ScrollTrigger.create({
      trigger: "#home",
      start: "top center",
      endTrigger: "section:first-child",
      end: "bottom top",
      toggleClass: { targets: fixedNav, className: "show" }
    });

    // Smooth scroll
    function scrollToSection(id) {
      document.getElementById(id).scrollIntoView({ behavior: "smooth" });
    }
  </script>
</body>
</html>
